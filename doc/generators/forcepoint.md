# Forcepoint NGFW

The forcepoint header designation has the following format:

```
target:: forcepoint [policy-name] [address-family] [output-format] [api-version]
```

  * _policy-name_: defines the name of the Forcepoint firewall policy
  * _address-family_: specifies the address family for the resulting policy
    - _inet_: the policy should only render IPv4 addresses (default)
    - _inet6_: the policy should only render IPv6 addresses
    - _mixed_: the policy should render IPv4 and IPv6 addresses
  * _output-format_: specifies the output format for the generated configuration
    - _json_: generate JSON format for REST API deployment (default)
    - _sdk_: generate Python script using SMC Python SDK
    - _xml_: generate XML format for import/export operations
  * _api-version_: specifies the Forcepoint API version
    - _v6_: Forcepoint API v6.x (default)
    - _v7_: Forcepoint API v7.x

## Example Headers

```
# Basic IPv4 policy with JSON output
target:: forcepoint corporate-firewall inet json

# Mixed IPv4/IPv6 policy with SDK output
target:: forcepoint datacenter-policy mixed sdk v7

# IPv6 policy with XML output for import
target:: forcepoint ipv6-external inet6 xml
```

## Term Format

* _action::_ The action to take when matched. See Actions section for valid options.
* _comment::_ A text comment enclosed in double-quotes. The comment can extend over multiple lines if desired, until a closing quote is encountered.
* _destination-address::_ One or more destination address tokens.
* _destination-port::_ One or more service definition tokens.
* _expiration::_ stop rendering this term after specified date. [YYYY](YYYY.md)-[MM](MM.md)-[DD](DD.md)
* _icmp-type::_ Specify icmp-type code to match, see section [ICMP TYPES](PolicyFormat#ICMP_TYPES.md) for list of valid arguments
* _logging::_ Specify that this packet should be logged via syslog.
* _name::_ Name of the term.
* _owner::_ Owner of the term, used for organizational purposes.
* _platform::_ one or more target platforms for which this term should ONLY be rendered.
* _protocol::_ the network protocols this term will match, such as tcp, udp, icmp, or a numeric value.
* _source-address::_ one or more source address tokens.
* _source-port::_ one or more service definition tokens.

## Sub Tokens

### Actions

* _accept_: Allow traffic (mapped to Forcepoint "allow" action)
* _deny_: Discard traffic silently (mapped to Forcepoint "discard" action)
* _reject_: Reject traffic with ICMP response (mapped to Forcepoint "refuse" action)
* _reject-with-tcp-rst_: Reject TCP traffic with RST (mapped to Forcepoint "refuse" with TCP RST)

### Forcepoint-Specific Extensions

* _forcepoint-action::_ Forcepoint-specific action override
  - _allow_: Standard allow action
  - _continue_: Continue processing to next rule
  - _blacklist_: Add source to blacklist
  - _discard_: Silent discard (default for deny)
  - _refuse_: Reject with ICMP/TCP response

* _forcepoint-log-level::_ Logging level for the rule
  - _none_: No logging
  - _stored_: Store in logs (default when logging enabled)
  - _alert_: Generate alert
  - _essential_: Mark as essential log

* _forcepoint-inspection::_ Deep inspection settings
  - _enabled_: Enable deep inspection
  - _disabled_: Disable deep inspection
  - _bypass_: Bypass inspection

* _forcepoint-connection-tracking::_ Connection tracking mode
  - _state_: Stateful inspection (default)
  - _no-state_: Stateless inspection

## Output Formats

### JSON Format (REST API)

Generates JSON structure compatible with Forcepoint REST API v6.x/v7.x:

```json
{
  "policy": {
    "name": "corporate-firewall",
    "comment": "Generated by Capirca",
    "rules": [
      {
        "name": "allow-web",
        "comment": "Allow HTTP/HTTPS traffic",
        "sources": {
          "src": [
            {"name": "INTERNAL_NET", "type": "network"}
          ]
        },
        "destinations": {
          "dst": [
            {"name": "WEBSERVERS", "type": "host"}
          ]
        },
        "services": {
          "service": [
            {"name": "HTTP", "type": "tcp_service"},
            {"name": "HTTPS", "type": "tcp_service"}
          ]
        },
        "action": {"action": "allow"},
        "options": {
          "log_level": "stored",
          "connection_tracking": "state"
        }
      }
    ]
  }
}
```

### SDK Format (Python Script)

Generates Python script using Forcepoint SMC Python SDK:

```python
#!/usr/bin/env python3
"""Generated Forcepoint SMC deployment script"""

from smc import session
from smc.policy.layer3 import FirewallPolicy
from smc.elements.network import Host, Network
from smc.elements.service import TCPService, UDPService

def deploy_policy():
    # Connect to SMC
    session.login(url='https://smc.example.com:8082', 
                  api_key='your-api-key-here')
    
    try:
        # Create or get policy
        policy = FirewallPolicy.create('corporate-firewall')
        
        # Add rules
        policy.fw_ipv4_access_rules.create(
            name='allow-web',
            sources=[Network('INTERNAL_NET')],
            destinations=[Host('WEBSERVERS')],
            services=[TCPService('HTTP'), TCPService('HTTPS')],
            action='allow',
            log_level='stored'
        )
        
        print(f"Policy {policy.name} deployed successfully")
        
    finally:
        session.logout()

if __name__ == '__main__':
    deploy_policy()
```

### XML Format (Import/Export)

Generates XML structure for Forcepoint import/export operations:

```xml
<policy name="corporate-firewall">
    <comment>Generated by Capirca</comment>
    <rule name="allow-web">
        <comment>Allow HTTP/HTTPS traffic</comment>
        <sources>
            <element>INTERNAL_NET</element>
        </sources>
        <destinations>
            <element>WEBSERVERS</element>
        </destinations>
        <services>
            <element>HTTP</element>
            <element>HTTPS</element>
        </services>
        <action>allow</action>
        <logging>stored</logging>
    </rule>
</policy>
```

## Network and Service Objects

Forcepoint generator automatically creates network and service objects referenced in policies:

### Network Objects

* **Host**: Single IP address objects
* **Network**: Network subnet objects  
* **Group**: Network groups for multiple objects

### Service Objects

* **TCP Service**: TCP port-based services
* **UDP Service**: UDP port-based services
* **ICMP Service**: ICMP type/code services
* **IP Protocol**: IP protocol number services

## Deployment Methods

### 1. REST API Deployment

Use the generated JSON with Forcepoint REST API:

```bash
# Deploy policy via API
curl -X POST "https://smc.example.com:8082/api/v6/policy" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_TOKEN" \
  -d @corporate-firewall.forcepoint.json
```

### 2. SMC Python SDK

Execute the generated Python script:

```bash
# Install SMC SDK
pip install smc-python

# Run generated script
python corporate-firewall.forcepoint.py
```

### 3. XML Import

Import generated XML via SMC:

```bash
# Import via SMC CLI
smc-cli import --file corporate-firewall.forcepoint.xml --type policy
```

## Best Practices

1. **Naming Conventions**: Use descriptive names for policies and terms
2. **Object Management**: Leverage Capirca's naming system for consistent object references
3. **Logging**: Enable logging for critical rules
4. **Testing**: Test policies in non-production environment first
5. **Version Control**: Store generated policies in version control
6. **Documentation**: Include meaningful comments for complex rules

## Limitations

* **VPN Policies**: Not supported through standard generator (requires separate handling)
* **IPS Signatures**: Not part of standard Capirca policy model
* **Application Control**: Limited to basic protocol/port matching
* **QoS**: Not supported in current implementation

## Integration with Capirca Naming

The Forcepoint generator integrates with Capirca's naming system:

```python
# Example naming definitions (def/networks.def)
INTERNAL_NET = 10.0.0.0/8
DMZ_NETWORK = 192.168.100.0/24
WEBSERVERS = 192.168.100.10-192.168.100.20

# Example service definitions (def/services.def)
HTTP = 80/tcp
HTTPS = 443/tcp
DNS = 53/udp
```

These definitions are automatically referenced in generated Forcepoint configurations.

## Error Handling

The generator provides comprehensive error handling for:

* Invalid policy syntax
* Unsupported keywords
* Network address validation
* Service definition errors
* API format validation

## Migration from Other Platforms

When migrating from existing firewall platforms:

1. **Analyze Existing Policies**: Review current rule sets
2. **Map Objects**: Convert existing network/service objects
3. **Test Thoroughly**: Validate policy behavior in test environment
4. **Gradual Rollout**: Deploy in phases to minimize risk

## Support

For issues with the Forcepoint generator:

1. Check Capirca documentation
2. Review Forcepoint REST API documentation
3. Consult existing generator implementations
4. Submit GitHub issues with example policies